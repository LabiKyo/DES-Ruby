# encoding: UTF-8
require "des"

KEY_HEX = '3b3898371520f75e'
KEY_BIT = '0011101100111000100110000011011100010101001000001111011101011110'
ROUND = [
  '01000100110000000110101111011100100111011000100001111111', # ROUND[0]
  '10001001100000001101011110101001001110110001000011111111', # ROUND[1]
  '00010011000000011010111101010010011101100010000111111111', # ROUND[2]
  '01001100000001101011110101001001110110001000011111111100', # ROUND[3]
  '00110000000110101111010100010111011000100001111111110010', # ROUND[4]
  '11000000011010111101010001001101100010000111111111001001', # ROUND[5]
  '00000001101011110101000100110110001000011111111100100111', # ROUND[6]
  '00000110101111010100010011001000100001111111110010011101', # ROUND[7]
  '00011010111101010001001100000010000111111111001001110110', # ROUND[8]
  '00110101111010100010011000000100001111111110010011101100', # ROUND[9]
  '11010111101010001001100000000000111111111001001110110001', # ROUND[10]
  '01011110101000100110000000110011111111100100111011000100', # ROUND[11]
  '01111010100010011000000011011111111110010011101100010000', # ROUND[12]
  '11101010001001100000001101011111111001001110110001000011', # ROUND[13]
  '10101000100110000000110101111111100100111011000100001111', # ROUND[14]
  '10100010011000000011010111101110010011101100010000111111', # ROUND[15]
  '01000100110000000110101111011100100111011000100001111111', # ROUND[16]
]

describe String do
  context "when calling #is_hex" do
    it "return true if it's hex" do
      KEY_HEX.is_hex.should be_true
      KEY_HEX.upcase.is_hex.should be_true
    end
    it "return false if it contain not-hex characters" do
      '3b3898371520f75g'.is_hex.should be_false
      '3b3898371520f75G'.is_hex.should be_false
    end
  end
  context "when calling #left_rotate(i)" do
    it "left rotate i bits" do
      "01234".left_rotate(1).should eq "12340"
    end
  end
end

describe Key do
  before :each do
    @key = Key.new KEY_HEX
  end
  it "initialize with 16 hex numbers" do
    key = Key.new KEY_HEX
    key.key.should eq KEY_BIT
  end
  it "raise an error when initialize with wrong arguments" do
    expect {
      Key.new '123'
    }.to raise_error ArgumentError
  end
  0.upto 16 do |i|
    it "has the right round #{i}" do
      @key.round[i].should eq ROUND[i]
    end
  end
end
